{
   "constantName": "pbadm.PageRoles",
   "extendsPage": null,
   "fileTimestamp": "2019-02-05T11:51:36Z",
   "modelView": {
      "components": [
         {
            "name": "pageRoles",
            "resource": "virtualDomains.pbadmPageRoles",
            "staticData": [],
            "type": "resource"
         },
         {
            "name": "pageLookup",
            "resource": "virtualDomains.pbadmPageLookup",
            "type": "resource"
         },
         {
            "name": "webTailorRolesLookup",
            "resource": "virtualDomains.pbadmWebTailorRoles",
            "type": "resource"
         },
         {
            "name": "pagesecurity",
            "resource": "pagesecurity",
            "staticData": [],
            "type": "resource"
         },
         {
            "name": "appliedPageRolesRes",
            "resource": "virtualDomains.pbadmAppliedPageRoles",
            "staticData": [],
            "type": "resource"
         },
         {
            "components": [
               {
                  "label": "Page",
                  "labelKey": "CONSTANT_NAME",
                  "loadInitially": true,
                  "model": "selectPage",
                  "name": "selectPage",
                  "onLoad": "$editPageRoles.$load();\n$EditRolesForm.$visible=$selectPage;\n$roleName.$populateSource();\n$ApplyRolesForm.$visible=$selectPage;\n$appliedPageRoles.$load();",
                  "onUpdate": "$editPageRoles.$load();\n$EditRolesForm.$visible=$selectPage;\n$roleName.$populateSource();\n$ApplyRolesForm.$visible=$selectPage;\n$appliedPageRoles.$load();",
                  "placeholder": "Select...",
                  "required": false,
                  "sourceModel": "pageLookup",
                  "style": "col-sm-6",
                  "sourceParameters": {},
                  "type": "select",
                  "valueKey": "PID"
               },
               {
                  "valueStyle": "primary",
                  "onClick": "var baseUrl = location.origin; \nvar path = \"/BannerExtensibility/visualPageModelComposer/loadComposerPage\";\nvar url = baseUrl + path;\nlocation.assign(url);",
                  "name": "visualPageComposerButton",
                  "style": "col-sm-6",
                  "label": "Visual Page Composer",
                  "type": "button"
               }
            ],
            "label": "",
            "name": "SelectPageBlock",
            "style": "col-sm-12",
            "showInitially": true,
            "type": "block"
         },
         {
            "components": [
               {
                  "allowDelete": true,
                  "allowModify": true,
                  "allowNew": true,
                  "allowReload": true,
                  "components": [
                     {
                        "documentation": "Should have some way to forbid selecting existing roles for this domain...",
                        "label": "Role",
                        "labelKey": "DESCRIPTION",
                        "loadInitially": true,
                        "model": "ROLE_NAME",
                        "name": "roleName",
                        "onUpdate": "",
                        "placeholder": "Select unique role...",
                        "required": true,
                        "sourceModel": "webTailorRolesLookup",
                        "sourceParameters": {
                           "PAGE_ID": "$selectPage"
                        },
                        "type": "select",
                        "value": "",
                        "valueKey": "CODE"
                     },
                     {
                        "loadInitially": true,
                        "model": "PAGE_ID",
                        "name": "pageID",
                        "type": "hidden",
                        "value": "$selectPage"
                     },
                     {
                        "booleanFalseValue": "0",
                        "booleanTrueValue": "1",
                        "label": "Allow Access",
                        "loadInitially": true,
                        "model": "ALLOW",
                        "name": "allow",
                        "onUpdate": "",
                        "readonly": false,
                        "type": "boolean",
                        "value": "1"
                     }
                  ],
                  "label": "Edit Roles for selected page",
                  "loadInitially": false,
                  "model": "pageRoles",
                  "name": "editPageRoles",
                  "onError": "var errorMessage =response.data.errors? response.data.errors.errorMessage: null;\nif (errorMessage&&errorMessage.indexOf(\"ORA-20000\") > -1) {\n  alert(\"An entry already exists for this page and role, cannot add a duplicate\", {type:\"error\"});\n} else {\n  if (response.data.errors.errorMessage) {\n    alert(response.data.errors.errorMessage,{type:\"error\"});\n  }\n  else if (response.data.errors[0].errorMessage) {\n    alert(response.data.errors[0].errorMessage,{type:\"error\"});\n  } else {\n    alert(errorMessage?errorMessage:response.data, {type:\"error\"});\n  }\n}",
                  "onSave": "",
                  "onSaveSuccess": "var saveAction = \"saved\";\n\nif (response.hasOwnProperty(\"id\") && !_.findWhere($editPageRolesDS.data,     {ROLE_NAME: response.ROLE_NAME}))\n  {\n    saveAction = \"deleted\";\n  }\nalert( \"Page role \" + response.ROLE_NAME + \" \" + saveAction,{type:\"success\", flash:true});\n\n$applyRolesButton.$style=\"visible\";",
                  "pageSize": 5,
                  "parameters": {
                     "PAGE_ID": "$selectPage"
                  },
                  "submit": "",
                  "type": "grid"
               }
            ],
            "name": "EditRolesForm",
            "nextButtonLabel": "Next",
            "showInitially": false,
            "type": "form"
         },
         {
            "components": [
               {
                  "label": "Apply page roles",
                  "name": "applyRolesButton",
                  "onClick": "console.log('Apply pressed');\n$pagesecurity.$post({pageId:$selectPage}, null, \n  function(){\n     alert('Roles applied', {type:\"success\", flash:true}); \n     $appliedPageRoles.$load({clearCache:true});\n     $applyRolesButton.$style='hidden';\n    }\n);",
                  "style": "hidden",
                  "type": "button",
                  "valueStyle": "primary"
               },
               {
                  "allowDelete": false,
                  "allowModify": false,
                  "allowNew": false,
                  "allowReload": false,
                  "components": [
                     {
                        "asHtml": false,
                        "label": "URL",
                        "loadInitially": true,
                        "model": "URL",
                        "name": "url",
                        "type": "display"
                     },
                     {
                        "asHtml": false,
                        "label": "Spring Security Attributes",
                        "loadInitially": true,
                        "model": "CONFIG_ATTRIBUTE",
                        "name": "attributes",
                        "type": "display"
                     }
                  ],
                  "label": "Applied Page roles",
                  "loadInitially": false,
                  "model": "appliedPageRolesRes",
                  "name": "appliedPageRoles",
                  "pageSize": 5,
                  "parameters": {
                     "selected_url": "$selectPage.$selected?$selectPage.$selected.CONSTANT_NAME:null"
                  },
                  "type": "detail"
               }
            ],
            "name": "ApplyRolesForm",
            "nextButtonLabel": "",
            "showInitially": false,
            "submit": "",
            "submitLabel": "",
            "type": "form"
         }
      ],
      "documentation": "Associate Roles with a Page",
      "label": "Page Roles",
      "name": "pbadmPageRoles",
      "scriptingLanguage": "JavaScript",
      "title": "Associate Roles with a Page",
      "type": "page"
   },
   "pageRoles": [
      {
         "roleName": "ADMIN-GPBADMN",
         "allow": true
      }
   ]
}